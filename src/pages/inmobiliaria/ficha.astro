---
import "../../tailwind.css";
import Navbar from "../../components/Navbar.astro";
import CriticalStyles from "../../components/CriticalStyles.astro";
import WhatsAppButton from "../../components/WhatsAppButton.astro";
import Footer from "../../components/Footer.astro";
import { Image } from "astro:assets";

// Obtener el ID de la propiedad desde la URL
const { id } = Astro.url.searchParams;
const propertyId = id || "1"; // Si no hay ID, se usa 1 como valor predeterminado

// Función para obtener los datos de una propiedad específica
const fetchPropertyDetails = async (id) => {
    try {
        // Obtener detalles de la propiedad
        const response = await fetch(
            `https://urbancms.up.railway.app/api/properties/${id}`,
        );
        if (!response.ok) {
            throw new Error("Error al obtener detalles de la propiedad");
        }

        const property = await response.json();
        return property;
    } catch (error) {
        console.error("Error al obtener detalles de la propiedad:", error);

        // Fallback a una propiedad de ejemplo en caso de error
        return {
            id: parseInt(id),
            is_for_sale: true,
            type: "Venta",
            location: {
                line1: "Monte Elbrus 336",
                line2: "Frac. Colinas de Juriquilla",
                line3: "Querétaro, Mex.",
            },
            google_maps_url: "https://maps.google.com/",
            features: [
                "Terreno: 200 M2",
                "Construcción: 267 M2",
                "Recámaras: 4",
                "Baños: 5",
                "Cocheras: 2",
                "Jardín: 40 M2",
                "Vigilancia: SI",
            ],
            investment: 5900000,
            investment_formatted: "$ 5,900,000.00 MXN",
            images: [
                `https://urbancms.test/storage/property-images/image${id}_1.jpg`,
                `https://urbancms.test/storage/property-images/image${id}_2.jpg`,
                `https://urbancms.test/storage/property-images/image${id}_3.jpg`,
                `https://urbancms.test/storage/property-images/image${id}_4.jpg`,
            ],
            created_at: "2025-05-15T14:30:00.000000Z",
            updated_at: "2025-05-15T14:30:00.000000Z",
        };
    }
};

// Obtener detalles de la propiedad
const property = await fetchPropertyDetails(propertyId);

// Extraer características de la propiedad
const features = property.features || [];
const caracteristicas = {
    terreno:
        features.find((f) => f.includes("Terreno"))?.replace("Terreno: ", "") ||
        "200 M2",
    construccion:
        features
            .find((f) => f.includes("Construcción"))
            ?.replace("Construcción: ", "") || "267 M2",
    recamaras:
        features
            .find((f) => f.includes("Recámaras"))
            ?.replace("Recámaras: ", "") || "4",
    banos:
        features.find((f) => f.includes("Baños"))?.replace("Baños: ", "") ||
        "5",
    cocheras:
        features
            .find((f) => f.includes("Cocheras"))
            ?.replace("Cocheras: ", "") || "2",
    jardin:
        features.find((f) => f.includes("Jardín"))?.replace("Jardín: ", "") ||
        "40 M2",
    vigilancia:
        features
            .find((f) => f.includes("Vigilancia"))
            ?.replace("Vigilancia: ", "") || "SI",
};

// Asegurar que hay exactamente 4 imágenes
const imagenes = property.images || [];
while (imagenes.length < 4) {
    const index = imagenes.length;
    imagenes.push(
        `https://urbancms.test/storage/property-images/image${property.id}_${index + 1}.jpg`,
    );
}
// Si hay más de 4 imágenes, usar solo las primeras 4
const imagenesParaMostrar = imagenes.slice(0, 4);
---

<html>
    <head>
        <title>
            Propiedad en {property.location.line1} | Urban Arquitectura
        </title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="apple-touch-icon" sizes="180x180" href="/favicon02.png" />
        <link
            rel="icon"
            type="image/png"
            sizes="192x192"
            href="/favicon02.png"
        />
        <link rel="icon" type="image/png" sizes="32x32" href="/icono.png" />
        <CriticalStyles />

        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Lato:wght@300;400;700&family=Poppins:wght@500;700&display=swap"
            rel="stylesheet"
            media="print"
            onload="this.media='all'"
        />
    </head>
    <body>
        <Navbar />

        <div class="ficha-container">
            <!-- Encabezado con logo y título -->
            <div class="header-container">
                <div class="logo-container">
                    <img
                        src="/public/icons/icon_urban.svg"
                        alt="Urban Arquitectura Logo"
                        class="logo"
                    />
                </div>
                <div class="title-container">
                    <h1>{property.type}</h1>
                </div>
            </div>

            <!-- Galería de imágenes -->
            <div class="image-grid">
                <div class="grid-item">
                    <img
                        src={imagenesParaMostrar[0]}
                        alt="Imagen principal de la propiedad"
                        class="property-image"
                    />
                </div>
                <div class="grid-item">
                    <img
                        src={imagenesParaMostrar[1]}
                        alt="Segunda imagen de la propiedad"
                        class="property-image"
                    />
                </div>
                <div class="grid-item">
                    <img
                        src={imagenesParaMostrar[2]}
                        alt="Tercera imagen de la propiedad"
                        class="property-image"
                    />
                </div>
                <div class="grid-item">
                    <img
                        src={imagenesParaMostrar[3]}
                        alt="Cuarta imagen de la propiedad"
                        class="property-image"
                    />
                </div>
            </div>

            <!-- Información de la propiedad -->
            <div class="info-container">
                <!-- Ubicación -->
                <div class="ubicacion-container">
                    <h2>UBICACIÓN</h2>
                    <p>{property.location.line1}</p>
                    <p>{property.location.line2}</p>
                    <p>{property.location.line3}</p>
                </div>

                <!-- Inversión/Precio -->
                <div class="precio-container">
                    <h2>INVERSIÓN</h2>
                    <p class="precio">{property.investment_formatted}</p>
                </div>

                <!-- Características -->
                <div class="caracteristicas-container">
                    <h2>CARACTERÍSTICAS</h2>
                    <ul>
                        <li>
                            <span class="icon">◆</span> TERRENO : <span
                                class="valor">{caracteristicas.terreno}</span
                            >
                        </li>
                        <li>
                            <span class="icon">◆</span> CONSTRUCCIÓN : <span
                                class="valor"
                                >{caracteristicas.construccion}</span
                            >
                        </li>
                        <li>
                            <span class="icon">◆</span> RECÁMARAS : <span
                                class="valor">{caracteristicas.recamaras}</span
                            >
                        </li>
                        <li>
                            <span class="icon">◆</span> BAÑOS : <span
                                class="valor">{caracteristicas.banos}</span
                            >
                        </li>
                        <li>
                            <span class="icon">◆</span> COCHERAS : <span
                                class="valor">{caracteristicas.cocheras}</span
                            >
                        </li>
                        <li>
                            <span class="icon">◆</span> JARDIN : <span
                                class="valor">{caracteristicas.jardin}</span
                            >
                        </li>
                        <li>
                            <span class="icon">◆</span> VIGILANCIA : <span
                                class="valor">{caracteristicas.vigilancia}</span
                            >
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Iconos de contacto -->
            <div class="contact-icons">
                <a href="mailto:contacto@urban.com" class="icon-link">
                    <img
                        src="/images/pie-pagina/email.svg"
                        alt="Email"
                        class="contact-icon"
                    />
                </a>
                <a href="tel:+524421234567" class="icon-link">
                    <img
                        src="/images/pie-pagina/telefono.svg"
                        alt="Teléfono"
                        class="contact-icon"
                    />
                </a>
                <a href="https://wa.me/524421234567" class="icon-link">
                    <img
                        src="/images/pie-pagina/whatsapp.svg"
                        alt="WhatsApp"
                        class="contact-icon"
                    />
                </a>
                <a
                    href="https://facebook.com/urbanarquitectura"
                    class="icon-link"
                >
                    <img
                        src="/images/pie-pagina/facebook.svg"
                        alt="Facebook"
                        class="contact-icon"
                    />
                </a>
                <a
                    href="https://instagram.com/urbanarquitectura"
                    class="icon-link"
                >
                    <img
                        src="/images/pie-pagina/instagram.svg"
                        alt="Instagram"
                        class="contact-icon"
                    />
                </a>
                <a
                    href="https://tiktok.com/@urbanarquitectura"
                    class="icon-link"
                >
                    <img
                        src="/images/pie-pagina/tiktok.svg"
                        alt="TikTok"
                        class="contact-icon"
                    />
                </a>
            </div>
        </div>

        <WhatsAppButton />
        <Footer />
    </body>
</html>

<style>
    body {
        margin: 0;
        padding: 0;
        font-family: "Montserrat", sans-serif;
        background-color: #fff;
        color: #333;
    }

    .ficha-container {
        max-width: 1200px;
        margin: 6rem auto 2rem;
        padding: 0 1rem;
    }

    /* Header styling */
    .header-container {
        display: flex;
        margin-bottom: 1rem;
        background: linear-gradient(to right, white 45%, #1d2939 45%);
        height: 140px;
    }

    .logo-container {
        width: 45%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
    }

    .logo {
        max-height: 100px;
        max-width: 100%;
    }

    .title-container {
        width: 55%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #1d2939;
        color: white;
    }

    .title-container h1 {
        font-size: 3.5rem;
        font-weight: 700;
        margin: 0;
        letter-spacing: 2px;
    }

    /* Image grid styling */
    .image-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 0.5rem;
        margin-bottom: 1.5rem;
    }

    .grid-item {
        width: 100%;
        height: 250px;
        overflow: hidden;
    }

    .property-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .property-image:hover {
        transform: scale(1.05);
    }

    /* Info container styling */
    .info-container {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .ubicacion-container,
    .precio-container {
        width: 100%;
        padding: 1rem;
        border: 2px solid #1d2939;
        text-align: center;
    }

    @media (min-width: 768px) {
        .ubicacion-container,
        .precio-container {
            width: calc(50% - 2rem - 0.5rem);
        }
    }

    .caracteristicas-container {
        width: 100%;
        padding: 1rem;
        background-color: #1d2939;
        color: white;
    }

    h2 {
        font-size: 1.5rem;
        font-weight: 700;
        text-align: center;
        margin-top: 0;
        margin-bottom: 1rem;
        border-bottom: 1px solid #ccc;
        padding-bottom: 0.5rem;
    }

    .precio-container h2 {
        border-bottom: 1px solid #1d2939;
    }

    .caracteristicas-container h2 {
        border-bottom: 1px solid white;
    }

    .precio {
        font-size: 2rem;
        font-weight: 700;
        margin: 0;
    }

    .caracteristicas-container ul {
        list-style: none;
        padding: 0;
        margin: 0;
        columns: 1;
    }

    @media (min-width: 768px) {
        .caracteristicas-container ul {
            columns: 2;
        }
    }

    .caracteristicas-container li {
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
    }

    .icon {
        margin-right: 0.5rem;
        color: #4fd1c5;
    }

    .valor {
        margin-left: auto;
        font-weight: 700;
    }

    /* Contact icons styling */
    .contact-icons {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .icon-link {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: #4fd1c5;
        transition: background-color 0.3s ease;
    }

    .icon-link:hover {
        background-color: #38b2ac;
    }

    .contact-icon {
        width: 24px;
        height: 24px;
    }
</style>

<script>
    // Add any JavaScript needed for interactivity
    document.addEventListener("DOMContentLoaded", () => {
        console.log("Ficha de propiedad cargada correctamente");

        // You could add gallery slider functionality here if needed
    });
</script>
